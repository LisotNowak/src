{% extends 'base.html.twig' %}

{% block title %}Mes commandes{% endblock %}

{% block sidebar %}
    {% include 'dotation/sidebar.html.twig' with {'active_link': 'mes_commandes'} %}
{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>Mes commandes</h1>

    <form method="get" class="mb-3">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label for="etatFilter" class="col-form-label">Filtrer par état :</label>
            </div>
            <div class="col-auto">
                <select id="etatFilter" name="etat" class="form-select" onchange="this.form.submit()">
                    <option value="" {{ selectedEtat == '' ? 'selected' : '' }}>Tous les états</option>
                    {% for e in etats %}
                        <option value="{{ e }}" {{ selectedEtat == e ? 'selected' : '' }}>{{ e }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-auto">
                <a href="{{ path('app_mes_commandes_dota') }}" class="btn btn-outline-secondary">Réinitialiser</a>
            </div>
        </div>
    </form>

    {% if commandes is empty %}
        <div class="alert alert-info">Vous n'avez aucune commande.</div>
    {% else %}
        {% for entry in commandes %}
            {% set commande = entry.commande %}
            <div class="card mb-3">
                <div class="card-header">
                    <strong>Commande #{{ commande.id }}</strong>
                    <span class="float-right">{{ commande.date }}</span>
                    <div class="small text-muted">État : {{ commande.nomEtat }}</div>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Réf</th>
                                <th>Nom</th>
                                <th>Taille</th>
                                <th>Couleur</th>
                                <th>Quantité</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for it in entry.items %}
                                <tr>
                                    <td>{{ it.article ? it.article.reference : '—' }}</td>
                                    <td>{{ it.article ? it.article.nom : 'Article supprimé' }}</td>
                                    <td>{{ it.taille }}</td>
                                    <td>{{ it.couleur }}</td>
                                    <td>{{ it.quantite }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endfor %}
    {% endif %}

</div>
{% endblock %}